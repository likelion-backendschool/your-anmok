<!--í°íŠ¸ì–´ì¸-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css">


<!doctype html>
<html lang="ko">
<head>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<!--    <script src="https://kit.fontawesome.com/def66b134a.js" crossorigin="anonymous"></script>-->
</head>
<body>

<div class="container my-3">
    <div class="d-flex flex-row">
        <section class="content w-75">
            <div class="content_wrap">
                <div class="title">
                    <h2 th:text="${detailList.getTitle()}"></h2>
                </div>
                <div class="name">
                    <p th:text="${detailList.getNickname()}"></p>
                    <p th:text="${#temporals.format(detailList.getCreatedAt(), 'yyyy.MM.dd HH:mm:ss')}"></p>
                </div>

                <div class="text">
                    <p th:text="${detailList.getText()}"></p>
                </div>

                <div class="comment">
                    <p>ğŸ’¬ ëŒ“ê¸€</p>
                    <p>&#40; <span th:text="${commentList.size()}"></span> &#41;</p>
                </div>

                <div class="card my-3" th:each="comment, index:${commentList}">
                    <div class="card-body">
                        <a th:id="${comment.commentId}"></a>
                        <div class="d-flex flex-row">
                            <div class="box">
                                <img th:src="${comment.img}" alt="í”„ë¡œí•„ ì‚¬ì§„">
                            </div>
                            <div class="m-2 w-100">
                                <div class="d-flex justify-content-between ">
                                    <div th:text="${comment.nickname}"></div>
                                    <div th:text="${comment.createdAt}"></div>
                                </div>
                                <div class="d-flex m-2 justify-content-between ">
                                    <div th:text="${comment.comment}"></div>
                                    <div class="btn bg-light text-dark btn-sm text-start rounded-pill" th:id="|${comment.commentId}|" th:field="|comment-btn-${comment.commentId}|"
                                         th:reply="|reply-${comment.commentId}|" th:nick="${comment.nickname}"
                                         onclick="doAction(this.id, this.getAttribute('reply'), this.getAttribute('nick'))">â¤´ï¸ reply</div>
                                </div>
                            </div>
                        </div>
                        <div class="ms-5 d-flex flex-row" th:each="reply, index:${comment.replyList}">

                            <br>
                            <div class="box">
                                <i class="fa-solid fa-arrow-turn-down-right"></i>
                                <img th:src="${reply.img}" alt="í”„ë¡œí•„ ì‚¬ì§„">
                            </div>
                            <div class="m-2 w-100">
                                <div class="d-flex justify-content-between ">
                                    <div th:text="${reply.nickname}"></div>
                                    <div th:text="${reply.createdAt}"></div>
                                </div>
                                <div class="d-flex m-2 justify-content-between ">
                                    <div th:text="${reply.comment}"></div>
                                    <div th:id="|${comment.commentId}|" th:reply="|reply-${comment.commentId}|" th:nick="${reply.nickname}" th:field="|comment-btn-${reply.commentId}|" class="btn bg-light text-dark btn-sm text-start rounded-pill" onclick="doAction(this.id, this.getAttribute('reply'), this.getAttribute('nick'))">â¤´ï¸ reply</div>
                                </div>

                            </div>
                        </div>
                        <form th:action="@{|/comment/create/${id}|}" th:object="${commentForm}" method="post">
                            <input type="hidden" th:id="applyTo" name="applyTo" th:value="${comment.commentId}" />
                            <input type="hidden" th:id="mentionTo" name="mentionTo" value="" />

                            <div style="display:none !important" th:id="|reply-${comment.commentId}|" th:field="|reply-${comment.commentId}|"  class="d-flex input-group input-group-type-1">
                                  <span class="input-group-text" th:if="${comment.commentId != null}">
                                      <span name="mentionTo" th:id="|reply-nickname-${comment.commentId}|" value="" class="badge bg-primary rounded-pill">@ ë‹¤ì •</span>
                                  </span>
                                <input type="text"  th:field="*{content}" class="form-control" aria-describedby="basic-addon3">
                                <input type="submit" class="btn btn-outline-dark btn-sm m-0" value="ì‘ì„±">
                            </div>
                        </form>
                    </div>
                </div>
                <h5 class="border-bottom my-3 py-2">ğŸ“ ëŒ“ê¸€ì‘ì„±</h5>
                <form th:action="@{|/comment/create/${id}|}" th:object="${commentForm}" method="post" class="my-3">
                    <!--                    <div th:replace="form_errors :: formErrorsFragment"></div>-->
                    <textarea name="content" th:field="*{content}" rows="2" class="form-control"></textarea>
                    <div class="d-flex justify-content-end">
                        <input type="submit" value="ëŒ“ê¸€ê¸°ë‹¬" class="btn btn-outline-dark btn-sm m-2">
                    </div>
                </form>
            </div>
        </section>


        <div class="map w-20">
            <h2>ë²ˆê°œëª¨ì„ ì¥ì†Œ ì •ë³´</h2>
            <div id="map" style="width:100%; height:200px;"></div>
            <div>
                <p th:text="${detailList.getPlaceName()}"></p>
                <p th:text="${detailList.getAddress()}"></p>

                <div>
                    <p>ë‚ ì§œ</p>
                    <p th:text="${#temporals.format(detailList.getGatheringDate(), 'yyyy.MM.dd')}"></p>
                </div>

                <div>
                    <p>ì¸ì›</p>
                    <p>&#40; <span th:text="${detailList.getGatherCnt()}"></span> / <span th:text="${detailList.getTotalCnt()}"></span> &#41;</p>
                </div>

                <div>
                    <p>ë³„ì </p>

                </div>

                <div>
                    <p>ìƒì„¸ ì •ë³´</p>
                    <p>
                        ìœ„ì¹˜ë„ ì¢‹ì•„ ì¹´ê³µí•˜ê¸° ì¢‹ì€ ì¹´í˜ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0faeb3dc4793a50259747d85fd7d9a89"></script>
<script>
    var lat = [[${detailList.getLat()}]];
    var lon = [[${detailList.getLon()}]];

    console.log(lat);
    console.log(lon);

    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
        mapOption = {
            center: new kakao.maps.LatLng(lat, lon), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

    // ì§€ë„ë¥¼ í‘œì‹œí•  divì™€  ì§€ë„ ì˜µì…˜ìœ¼ë¡œ  ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤
    var markerPosition  = new kakao.maps.LatLng(lat, lon);

    // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var marker = new kakao.maps.Marker({
        position: markerPosition
    });

    // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
    marker.setMap(map);

    // ì•„ë˜ ì½”ë“œëŠ” ì§€ë„ ìœ„ì˜ ë§ˆì»¤ë¥¼ ì œê±°í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤
    // marker.setMap(null);
    // forms


    function doAction(id, reply, nickname) {
        // alert(nickname);
        const btn1 = document.getElementById(id);
        const replyInputForm = document.getElementById(reply);
        const replyNickname = "reply-nickname-"+id;

        // alert(replyNickname);
        if(btn1.style.display != 'none') {
            // btn1.style.display = 'none';
            replyInputForm.style.display = 'block';
            // $(replyInputForm).hide();
            // alert(nickname);
            // document.getElementById(replyNickname).innerHTML = nickname + "ë‹˜ì—ê²Œ ë‹µê¸€ ë‚¨ê¸°ëŠ” ì¤‘...";
            document.getElementById(replyNickname).innerHTML = "@"+nickname;
            document.getElementById("mentionTo").value = nickname;
            // $("#reply-nickname").text(nickname);
        } else {
            replyInputForm.style.display = 'block';
        }
    }
</script>
</body>
<head>
    <meta charset="utf-8">
    <title>ìƒì„¸ë³´ê¸°</title>
    <link rel="stylesheet" type="text/css" href="/css/gathering/detail.css">
</head>

</html>
