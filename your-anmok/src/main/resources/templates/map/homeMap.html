<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>당신의 안목 메인페이지</title>

    <style>
        /*.map_wrap {position:relative;width:100%;height:500px;}*/

        #my_location_button{position: absolute;bottom:-150px;right:0;z-index: 100;}
        #my_location_button1{position: absolute;bottom:0;right:0;z-index: 100;}

        /*슬라이드 버튼 관련 CSS*/
        #hamburger_button {
            cursor:pointer;
            position:absolute;
            top:0px;
            left:0px;
            z-index: 200;
        }

        /* 추가된 부분 */
        .hamburger_line {
            display: inline-block;
            background:black;
            margin: 2px !important;
            width:56px;
            height:7px;
            border-radius:2px;
            box-shadow:0 1px 3px rgba(0,0,0,.5);
            position:relative;
            z-index: 200;
        }

        .left_sub_menu {
            position: fixed;
            top: 50px;
            width: 200px;
            z-index: 10;
            left: 0px;
            background: white;
            border-right: 1px solid rgba(0, 0, 0, 0.07);
            bottom: 50px;
            height: 100%;
            margin-bottom: -70px;
            margin-top: 0px;
            padding-bottom: 0px;
            box-shadow: 0 0px 24px 0 rgb(0 0 0 / 6%), 0 1px 0px 0 rgb(0 0 0 / 2%);
            color: black;
        }

        .sub_menu {
            margin-top: 50px;
        }

        .left_sub_menu>.sub_menu li:hover {
            color: #ff5858;
            background-color: #e1e1e1;
        }

        .left_sub_menu>.sub_menu li {
            color: #333;
            font-size: 17px;
            font-weight: 600;
            padding: 20px 0px 8px 14px;
            border-bottom: 1px solid #e1e1e1;
        }

        .sub_menu>h2 {
            padding-bottom: 4px;
            border-bottom: 3px solid #797979;
            margin-top: 30px;
            font-size: 21px;
            font-weight: 600;
            color: #333;
            margin-left: 10px;
            margin-right: 10px;
            font-family: 'NotoKrB';
            line-height: 35px;
        }

        .sub_menu .fas {
            color: #ff5858;
            font-size: 20px;
            line-height: 20px;
            float: right;
            margin-right: 20px;
        }

        .sub_menu>.big_menu>.small_menu li {
            color: #333;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 0px solid #e1e1e1;
            margin-left: 14px;
            padding-top: 8px;
        }

        .big_menu {
            cursor: pointer;
        }

        ul {
            padding-inline-start: 0px;
        }

        a {
            color: #797979;
            text-decoration: none;
            background-color: transparent;
            display: block;
            cursor: pointer;
        }

        ul {
            list-style: none;
        }

        ol,
        ul {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .has_sub {
            width: 100%;
        }

        .overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }

        .hide_sidemenu {
            display: none;
        }

        /* */

        .map_wrap, .map_wrap * {margin:0;padding:0;font-family:'Malgun Gothic',dotum,'돋움',sans-serif;font-size:12px;}
        .map_wrap a, .map_wrap a:hover, .map_wrap a:active{color:#000;text-decoration: none;}
        .map_wrap {position:relative;width:100%;height:500px;}
        #search_wrap {position:absolute;top:0;right:0;bottom:0;width:250px;margin:10px 0 30px 10px;padding:5px;overflow-y:auto;background:rgba(255, 255, 255, 0.7);z-index: 1;font-size:12px;border-radius: 10px;}
        .bg_white {background:#fff;}
        #search_wrap hr {display: block; height: 1px;border: 0; border-top: 2px solid #5F5F5F;margin:3px 0;}
        #search_wrap .option{text-align: center;}
        #search_wrap .option p {margin:10px 0;}
        #search_wrap .option button {margin-left:5px;}
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.20.0/dist/full.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0faeb3dc4793a50259747d85fd7d9a89&libraries=services"></script>

    <link rel="stylesheet" type="text/css" href="/css/popup/popup.css">
    <style>
        #popup_layer {position:fixed;top:0;left:0;z-index: 10000; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4);display:none;}
        /*팝업 박스*/
        #popup_box{border-radius:10px;position: relative;top:50%;left:50%; width:1120px;height:630px;transform:translate(-50%, -50%);z-index:1002;box-sizing:border-box;background:#fff;box-shadow: 2px 5px 10px 0px rgba(0,0,0,0.35);-webkit-box-shadow: 2px 5px 10px 0px rgba(0,0,0,0.35);-moz-box-shadow: 2px 5px 10px 0px rgba(0,0,0,0.35);}
        /*팝업 닫기 버튼*/
        #close{width:20px;height:20px;position:absolute;top:50%;transform:translate(0, -50%);right:35px;}
        .usr_img{width:280px;height:210px;background-color:#afafaf}
        .next_btn_img, .prev_btn_img{position:absolute;vertical-align:middle;width:30px;height:30px;top:50%;left:50%;transform:translate(-50%, -50%);}
        .inner_contents_box{width:445px;height:117px;background-color:#e8f8f5;}
        #place_info{position:absolute;top:50%;transform:translate(0, -50%);margin-left: 56px;}
    </style>

</head>

<body>
<div class="map_wrap" style="position: relative;">
    <div id="map" class="w-screen h-screen" >

    </div>


    <button id="my_location_button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="getCurrentPosBtn()">
        마이로케이션버튼
    </button>
    <br>
    <button id="my_location_button1" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="ajaxTest()">ajax 테스트</button>
    <div id="search_wrap" class="bg_white" style="position: absolute; top:0; right: 0; z-index: 90;">
        <div class="option">
            <div>
                <form th:action="@{/map/searchMap}" >
                    키워드 : <input type="text" name="placeKeyword" value="" id="keyword" size="15" />
                    <button type="submit">검색하기</button>
                </form>
            </div>
        </div>
        <hr>
        <ul id="placeList" style="position: absolute; top: 30px; right: 0; z-index: 90;"></ul>
        <div id="pagination" style="position: absolute; top: 30px; right: 0; z-index: 90;"></div>
    </div>
    <div id="menu">
        <div class="close"></div>

        <a id="hamburger_button" class="fas fa-bars fa-3x"></a>

        <div class="left_sub_menu">
            <div class="sub_menu">
                <h2>메뉴</h2>
                <ul class="big_menu">
                    <li><a href="/category/home">카테고리</a></li>
<!--                    <ul class="small_menu">-->
<!--                        <li><a href="#">소메뉴1-1</a></li>-->
<!--                        <li><a href="#">소메뉴1-2</a></li>-->
<!--                        <li><a href="">소메뉴1-3</a></li>-->
<!--                        <li><a href="#">소메뉴1-4</a></li>-->
<!--                    </ul>-->
                </ul>
                <ul class="big_menu">
                    <li><a href="/gathering/list">번개모임</a></li>
<!--                    <ul class="small_menu">-->
<!--                        <li><a href="#">소메뉴2-1</a></li>-->
<!--                        <li><a href="#"></a>소메뉴2-2</a></li>-->
<!--                    </ul>-->
                </ul>
                <ul class="big_menu">
                    <li><a href="/mapSearch">MYPAGE</a></li>
                </ul>
            </div>
        </div>
    </div>
<!--    <div th:each="placeInfo, status: ${placeList}">-->
<!--        <a style="color: #01C9C6" th:text="${placeInfo.name}" th:text="${placeInfo.address}" th:onload="displayDbMarker(${placeInfo.name}, ${placeInfo.address})" ></a>-->
<!--    </div>-->
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0faeb3dc4793a50259747d85fd7d9a89&libraries=services&autoload=false"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script th:inline="javascript">
    // 컨트롤러에 있는 값을 th:inline="javascript"를 통해 자바스크립트로 가져오기 밑에 있는 주석은 꼭 달아줘야 한다.

    /*<![CDATA[*/

    let myPlaceList = [[${myPlaceList}]];
    console.log(myPlaceList);

    for (let i=0;i<myPlaceList.length;i++){
        console.log(myPlaceList[i].name);
        console.log(myPlaceList[i].address);
    }

    /*]]>*/

</script>

<script>
    // th:inline 값이 그냥 javascript로 들어오는지 확인하기
    // console.log("잘 넘어오는지확인해보기 : "+myPlaceList[1].name);
    let container = document.getElementById("map");
    let options = {
        // 일단 홍대를 중심으로 잡는 맵 생성
        center: new kakao.maps.LatLng(37.511133583298516, 126.97978788338133),
        // // 일단 적당한 지도의 높이 레벨 7 정도로 수정
        level: 7
    };

    let map = new kakao.maps.Map(container, options);

    // markerPosition(포지션)을 Latlng로 포지션화(좌표화) -> 스타벅스 홍대점 좌표 구해서 넣었습니다.
    let starbucksHondaeMarkerPosition = new kakao.maps.LatLng(37.55751541928109, 126.92520449490704);

    // starbucksHondaeMarker 생성자
    let starbucksHondaeMarker = new kakao.maps.Marker({
        position: starbucksHondaeMarkerPosition,
        clickable: true
    })
    // displayInfowindow(starbucksHondaeMarker, "스타벅스닷");

    // starbucksHongdaeMarker를 지도 위에 표시 -> setMap
    starbucksHondaeMarker.setMap(map);

    $(function () {
        $(".left_sub_menu").hide();
        $("#hamburger_button").click(function () {
            $(".left_sub_menu").fadeToggle(300);
        });
        // // 왼쪽메뉴 드롭다운
        // $(".sub_menu ul.small_menu").hide();
        // $(".sub_menu ul.big_menu").click(function () {
        //     $("ul", this).slideToggle(300);
        // });
        // 외부 클릭 시 좌측 사이드 메뉴 숨기기
        $('#map').on('click', function () {
            $('.left_sub_menu').fadeOut();
            $('.hide_sidemenu').fadeIn();
        });
    });

    // 주소 - 좌표 변환 객체를 생성한다.
    let geocoder = new kakao.maps.services.Geocoder();

    // 주소로 좌표를 검색한다.
    for (let i =0;i<myPlaceList.length;i++) {

        geocoder.addressSearch(myPlaceList[i].address, function (result, status) {
            let coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            // 결과값으로 받은 위치를 마커로 표시
            let marker = new kakao.maps.Marker({
                map: map,
                position: coords
            });




            let infowindow = new kakao.maps.InfoWindow({
                content: '<div style="width:150px;text-align:center;padding:6px 0;">' + myPlaceList[i].name + '</div>'
            });



            infowindow.open(map, marker);

            kakao.maps.event.addEventListener(marker, 'mouseout', function () {
                // 마커에 마우스아웃 이벤트 발생하면 인포윈도우 제거
                infowindow.close();

            });

            // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다.

        })
    }
    function locationLoadSuccess(pos) {
        let currentPos = new kakao.maps.LatLng(
            pos.coords.latitude,
            pos.coords.longitude
        );

        map.panTo(currentPos);

        let marker = new kakao.maps.Marker({
            position: currentPos,
        });

        marker.setMap(null);
        marker.setMap(map);
    }

    function getCurrentPosBtn() {
        navigator.geolocation.getCurrentPosition(locationLoadSuccess, null);
        console.log("현재위치 버튼 클릭됨");
    }

    kakao.maps.event.addListener(starbucksHondaeMarker, 'click', function (){
        document.getElementById("popup_layer").style.display='block'
        console.log("스타벅스 클릭");
    });

    function closePopup(){
        document.getElementById("popup_layer").style.display="none"
    };

    // 마커 클릭시 장소명 표출하는 인포윈도우

    let infowindow = new kakao.maps.InfoWindow({zIndex:1});

    // 장소 검색 객체를 생성
    var ps = new kakao.maps.services.Places();

    // ------------------------ 키워드 검색 ----------

    let markers = [];


</script>

<!--팝업창 레이아웃 html-->
<div id="popup_layer">
    <div id="popup_box">
        <!--팝업 컨텐츠 영역-->
        <div id="popup_contents ">
            <th:block th:replace="popup/popup :: contentsTop"></th:block>
            <th:block th:replace="popup/popup :: contentsMiddle"></th:block>
            <th:block th:replace="popup/popup :: contentsBottom"></th:block>
        </div>
    </div>
</div>
</body>
<script>

</script>
</html>
<!--git remote update  -> git checkout 해당 브랜치 -> git merge  -->
<!-- -->
