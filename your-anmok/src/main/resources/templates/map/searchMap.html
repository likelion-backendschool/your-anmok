<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>ë‹¹ì‹ ì˜ ì•ˆëª© ê²€ìƒ‰í˜ì´ì§€</title>

    <style>
        /*.map_wrap {position:relative;width:100%;height:500px;}*/

        #my_location_button{position: absolute;bottom:-150px;right:0;z-index: 100;}
        #my_location_button1{position: absolute;bottom:0;right:0;z-index: 100;}

        /*ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ ê´€ë ¨ CSS*/
        #hamburger_button {
            cursor:pointer;
            position:absolute;
            top:0px;
            left:0px;
            z-index: 200;
        }

        /* ì¶”ê°€ëœ ë¶€ë¶„ */
        .hamburger_line {
            display: inline-block;
            background:black;
            margin: 2px !important;
            width:56px;
            height:7px;
            border-radius:2px;
            box-shadow:0 1px 3px rgba(0,0,0,.5);
            position:relative;
            z-index: 200;
        }

        .left_sub_menu {
            position: fixed;
            top: 50px;
            width: 300px;
            z-index: 10;
            left: 0px;
            background: white;
            border-right: 1px solid rgba(0, 0, 0, 0.07);
            bottom: 50px;
            height: 100%;
            margin-bottom: -70px;
            margin-top: 0px;
            padding-bottom: 0px;
            box-shadow: 0 0px 24px 0 rgb(0 0 0 / 6%), 0 1px 0px 0 rgb(0 0 0 / 2%);
            color: black;
        }

        .sub_menu {
            margin-top: 50px;
        }

        .left_sub_menu>.sub_menu li:hover {
            color: #ff5858;
            background-color: #e1e1e1;
        }

        .left_sub_menu>.sub_menu li {
            color: #333;
            font-size: 17px;
            font-weight: 600;
            padding: 20px 0px 8px 14px;
            border-bottom: 1px solid #e1e1e1;
        }

        .sub_menu>div {
            padding-bottom: 4px;
            border-bottom: 3px solid #797979;
            margin-top: 30px;
            font-size: 21px;
            font-weight: 600;
            color: #333;
            margin-left: 10px;
            margin-right: 10px;
            font-family: 'NotoKrB';
            line-height: 35px;
        }

        .sub_menu .fas {
            color: #ff5858;
            font-size: 20px;
            line-height: 20px;
            float: right;
            margin-right: 20px;
        }

        .sub_menu>.big_menu>.small_menu li {
            color: #333;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 0px solid #e1e1e1;
            margin-left: 14px;
            padding-top: 8px;
        }

        .big_menu {
            cursor: pointer;
        }

        ul {
            padding-inline-start: 0px;
        }

        a {
            color: #797979;
            text-decoration: none;
            background-color: transparent;
            display: block;
            cursor: pointer;
        }

        ul {
            list-style: none;
        }

        ol,
        ul {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .has_sub {
            width: 100%;
        }

        .overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }

        .hide_sidemenu {
            display: none;
        }

        /* */

        .map_wrap, .map_wrap * {margin:0;padding:0;font-family:'Malgun Gothic',dotum,'ë‹ì›€',sans-serif;font-size:12px;}
        .map_wrap a, .map_wrap a:hover, .map_wrap a:active{color:#000;text-decoration: none;}
        .map_wrap {position:relative;width:100%;height:500px;}
        #search_wrap {position:absolute;top:0;right:0;bottom:0;width:250px;margin:10px 0 30px 10px;padding:5px;overflow-y:auto;background:rgba(255, 255, 255, 0.7);z-index: 1;font-size:12px;border-radius: 10px;}
        .bg_white {background:#fff;}
        #search_wrap hr {display: block; height: 1px;border: 0; border-top: 2px solid #5F5F5F;margin:3px 0;}
        #search_wrap .option{text-align: center;}
        #search_wrap .option p {margin:10px 0;}
        #search_wrap .option button {margin-left:5px;}
        #placesList li {list-style: none;}
        #placesList .item {position:relative;border-bottom:1px solid #888;overflow: hidden;cursor: pointer;min-height: 65px;}
        #placesList .item span {display: block;margin-top:4px;}
        #placesList .item h5, #placesList .item .info {text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
        #placesList .item .info{padding:10px 0 10px 55px;}
        #placesList .info .gray {color:#8a8a8a;}
        #placesList .info .jibun {padding-left:26px;background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_jibun.png) no-repeat;}
        #placesList .info .tel {color:#009900;}
        #placesList .item .markerbg {float:left;position:absolute;width:36px; height:37px;margin:10px 0 0 10px;background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png) no-repeat;}
        #placesList .item .marker_1 {background-position: 0 -10px;}
        #placesList .item .marker_2 {background-position: 0 -56px;}
        #placesList .item .marker_3 {background-position: 0 -102px}
        #placesList .item .marker_4 {background-position: 0 -148px;}
        #placesList .item .marker_5 {background-position: 0 -194px;}
        #placesList .item .marker_6 {background-position: 0 -240px;}
        #placesList .item .marker_7 {background-position: 0 -286px;}
        #placesList .item .marker_8 {background-position: 0 -332px;}
        #placesList .item .marker_9 {background-position: 0 -378px;}
        #placesList .item .marker_10 {background-position: 0 -423px;}
        #placesList .item .marker_11 {background-position: 0 -470px;}
        #placesList .item .marker_12 {background-position: 0 -516px;}
        #placesList .item .marker_13 {background-position: 0 -562px;}
        #placesList .item .marker_14 {background-position: 0 -608px;}
        #placesList .item .marker_15 {background-position: 0 -654px;}
        #pagination {margin:10px auto;text-align: center;}
        #pagination a {display:inline-block;margin-right:10px;}
        #pagination .on {font-weight: bold; cursor: default;color:#777;}
    </style>

    <!--ì œì´ì¿¼ë¦¬-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <!--bxSlider JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bxslider/4.2.15/jquery.bxslider.min.js"></script>
    <!--bxSlider CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bxslider/4.2.15/jquery.bxslider.min.css" rel="stylesheet" />
    <!--í…Œì¼ìœˆë“œ-->
    <script src="https://cdn.tailwindcss.com"></script>
    <!--ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!--ë¶€íŠ¸ìŠ¤íŠ¸ë© JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <!--í°íŠ¸ì–´ì¸-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>
    <!--ì¹´ì¹´ì˜¤-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0faeb3dc4793a50259747d85fd7d9a89&libraries=services"></script>
    <!--CSSíŒŒì¼-->
    <link rel="stylesheet" type="text/css" href="/css/popup/popup.css">
</head>

<body>
<div class="map_wrap" style="position: relative;">
    <div id="map" class="w-screen h-screen" >

    </div>
    <button id="my_location_button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded fas fa-crosshairs" onclick="getCurrentPosBtn()">
    </button>
    <br>

    <div id="search_wrap" class="bg_white" style="position: absolute; top:0; right: 0; z-index: 90;">
        <div class="option">
            <div>
                <form onsubmit="searchPlaces(); return false;">
                    í‚¤ì›Œë“œ : <input type="text" th:text="${placeKeyword}" th:value="${placeKeyword}" id="keyword" size="15" />
                    <button type="submit">ê²€ìƒ‰í•˜ê¸°</button>
                </form>
            </div>
        </div>
        <hr>
        <ul id="placeList" style="position: absolute; top: 30px; right: 0; z-index: 90;"></ul>
        <div id="pagination" style="position: absolute; top: 30px; right: 0; z-index: 90;"></div>
    </div>

    <div id="menu">
        <div class="close"></div>

        <a id="hamburger_button" class="fas fa-bars fa-3x"></a>
        <input type="hidden" id="isAuthorized" th:value="${#authentication.getPrincipal() != 'anonymousUser'}?'Y':'N'"/>

        <div class="left_sub_menu">
            <div class="sub_menu">
                <div class="d-flex flex-row justify-between">
                    <a class="h3" href="/">ë‹¹ì‹ ì˜ ì•ˆëª© ğŸ‘€</a>
                    <!--                    <div>-->
                    <form action="/auth/loginProc" method="post">
                        <a sec:authorize="isAnonymous()" href="https://kauth.kakao.com/oauth/authorize?client_id=84bb53ddc4e742b0c6aa6c06a6372dbc&redirect_uri=http://localhost:8080/auth/kakao/callback&response_type=code"><img width="70px" height="50px" src="/image/KakaoLoginBtn.jpg"></a>
                        <div class="btn btn-warning" sec:authorize="isAuthenticated()"><a class="text-white text-decoration-none" href="/logout">ë¡œê·¸ì•„ì›ƒ</a></div>
                    </form>
                    <!--                    </div>-->
                </div>
                <ul class="big_menu">
                    <li><a href="/category/home">ì¹´í…Œê³ ë¦¬</a></li>
                    <!--                    <ul class="small_menu">-->
                    <!--                        <li><a href="#">ì†Œë©”ë‰´1-1</a></li>-->
                    <!--                        <li><a href="#">ì†Œë©”ë‰´1-2</a></li>-->
                    <!--                        <li><a href="">ì†Œë©”ë‰´1-3</a></li>-->
                    <!--                        <li><a href="#">ì†Œë©”ë‰´1-4</a></li>-->
                    <!--                    </ul>-->
                </ul>
                <ul class="big_menu">
                    <li><a href="/gathering/list">ë²ˆê°œëª¨ì„</a></li>
                    <!--                    <ul class="small_menu">-->
                    <!--                        <li><a href="#">ì†Œë©”ë‰´2-1</a></li>-->
                    <!--                        <li><a href="#"></a>ì†Œë©”ë‰´2-2</a></li>-->
                    <!--                    </ul>-->
                </ul>
                <ul class="big_menu">
                    <li><a href="/mypage">ë§ˆì´í˜ì´ì§€</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!--    <div th:each="placeInfo, status: ${placeList}">-->
    <!--        <a style="color: #01C9C6" th:text="${placeInfo.name}" th:text="${placeInfo.address}" th:onload="displayDbMarker(${placeInfo.name}, ${placeInfo.address})" ></a>-->
    <!--    </div>-->
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0faeb3dc4793a50259747d85fd7d9a89&libraries=services&autoload=false"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>
    // th:inline ê°’ì´ ê·¸ëƒ¥ javascriptë¡œ ë“¤ì–´ì˜¤ëŠ”ì§€ í™•ì¸í•˜ê¸°
    // console.log("ì˜ ë„˜ì–´ì˜¤ëŠ”ì§€í™•ì¸í•´ë³´ê¸° : "+myPlaceList[1].name);
    let container = document.getElementById("map");
    let options = {
        // ì¼ë‹¨ í™ëŒ€ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì¡ëŠ” ë§µ ìƒì„±
        center: new kakao.maps.LatLng(37.511133583298516, 126.97978788338133),
        // // ì¼ë‹¨ ì ë‹¹í•œ ì§€ë„ì˜ ë†’ì´ ë ˆë²¨ 7 ì •ë„ë¡œ ìˆ˜ì •
        level: 7
    };

    let map = new kakao.maps.Map(container, options);

    // markerPosition(í¬ì§€ì…˜)ì„ Latlngë¡œ í¬ì§€ì…˜í™”(ì¢Œí‘œí™”) -> ìŠ¤íƒ€ë²…ìŠ¤ í™ëŒ€ì  ì¢Œí‘œ êµ¬í•´ì„œ ë„£ì—ˆìŠµë‹ˆë‹¤.
    let starbucksHondaeMarkerPosition = new kakao.maps.LatLng(37.55751541928109, 126.92520449490704);

    // starbucksHondaeMarker ìƒì„±ì
    let starbucksHondaeMarker = new kakao.maps.Marker({
        position: starbucksHondaeMarkerPosition,
        clickable: true
    })
    // displayInfowindow(starbucksHondaeMarker, "ìŠ¤íƒ€ë²…ìŠ¤ë‹·");

    // starbucksHongdaeMarkerë¥¼ ì§€ë„ ìœ„ì— í‘œì‹œ -> setMap
    starbucksHondaeMarker.setMap(map);

    // let marker = new kakao.maps.Marker({
    //     position: markerPosition,
    //     clickable:true
    //
    // });

    // ã…‡ã…ì•½ìŠ¤ë¡œ ê°‘ë‹ˆë‹¤

    // function ajaxTest() {
    //     console.log("ì—°ê²°ë©ë‹ˆë‹¤.1")
    //     $.ajax({
    //         url: "http://localhost:8080",
    //         type: 'get',
    //         dataType: 'json',
    //         success: function(res) {
    //             console.log("ì—°ê²°ë©ë‹ˆë‹¤.2");
    //
    //             console.log("ì´ë¦„ :" + res);
    //
    //         }
    //     })
    // }

    $(function () {
        $(".left_sub_menu").hide();
        $("#hamburger_button").click(function () {
            $(".left_sub_menu").fadeToggle(300);
        });
        // // ì™¼ìª½ë©”ë‰´ ë“œë¡­ë‹¤ìš´
        // $(".sub_menu ul.small_menu").hide();
        // $(".sub_menu ul.big_menu").click(function () {
        //     $("ul", this).slideToggle(300);
        // });
        // ì™¸ë¶€ í´ë¦­ ì‹œ ì¢Œì¸¡ ì‚¬ì´ë“œ ë©”ë‰´ ìˆ¨ê¸°ê¸°
        $('#map').on('click', function () {
            $('.left_sub_menu').fadeOut();
            $('.hide_sidemenu').fadeIn();
        });
    });

    // // ì£¼ì†Œ - ì¢Œí‘œ ë³€í™˜ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    // let geocoder = new kakao.maps.services.Geocoder();
    //
    // // ì£¼ì†Œë¡œ ì¢Œí‘œë¥¼ ê²€ìƒ‰í•œë‹¤.
    // for (let i =0;i<myPlaceList.length;i++) {
    //
    //     geocoder.addressSearch(myPlaceList[i].address, function (result, status) {
    //         let coords = new kakao.maps.LatLng(result[0].y, result[0].x);
    //
    //         // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œ
    //         let marker = new kakao.maps.Marker({
    //             map: map,
    //             position: coords
    //         });
    //
    //
    //
    //
    //         let infowindow = new kakao.maps.InfoWindow({
    //             content: '<div style="width:150px;text-align:center;padding:6px 0;">' + myPlaceList[i].name + '</div>'
    //         });
    //
    //
    //
    //         infowindow.open(map, marker);
    //
    //         kakao.maps.event.addEventListener(marker, 'mouseout', function () {
    //             // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì•„ì›ƒ ì´ë²¤íŠ¸ ë°œìƒí•˜ë©´ ì¸í¬ìœˆë„ìš° ì œê±°
    //             infowindow.close();
    //
    //         });
    //
    //         // ì§€ë„ì˜ ì¤‘ì‹¬ì„ ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
    //
    //     })
    // }
    function locationLoadSuccess(pos) {
        let currentPos = new kakao.maps.LatLng(
            pos.coords.latitude,
            pos.coords.longitude
        );

        map.panTo(currentPos);
        map.setLevel(4);
    }

    function getCurrentPosBtn() {
        navigator.geolocation.getCurrentPosition(locationLoadSuccess, null);
        console.log("í˜„ì¬ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ë¨");
    }

    kakao.maps.event.addListener(starbucksHondaeMarker, 'click', function (){
        document.getElementById("popup_layer").style.display='block'
        console.log("ìŠ¤íƒ€ë²…ìŠ¤ í´ë¦­");
    });

    function closePopup(){
        document.getElementById("popup_layer").style.display="none"
    };

    // ë§ˆì»¤ í´ë¦­ì‹œ ì¥ì†Œëª… í‘œì¶œí•˜ëŠ” ì¸í¬ìœˆë„ìš°

    let infowindow = new kakao.maps.InfoWindow({zIndex:1});

    // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±
    var ps = new kakao.maps.services.Places();

    // ------------------------ í‚¤ì›Œë“œ ê²€ìƒ‰ ----------

    let markers = [];

    function selectPopUpPlace(places,name,address){
        // $("#addPlace_popup_layer #place-name").text(name);
        // $("#addPlace_popup_layer #place-address").text(address);
        console.log("idê°’ì€"+$(places).data('id'));
        console.log("latê°’ì€ : "+$(places).data('lat'));
        console.log("lonê°’ì€ : "+$(places).data('lon'));


        $('input[id=place-name]').attr('value',name);
        $('input[id=place-address]').attr('value',address);
        $('input[id=place-lat]').attr('value',$(places).data('lat'));
        $('input[id=place-lon]').attr('value',$(places).data('lon'));


        // $('#popup_box2').modal('show');
        console.log("íŒì—… ë²„íŠ¼ í´ë¦­!" + name + address);
    }

    // function selectPopUpPlace1(places,){
    //     // $("#addPlace_popup_layer #place-name").text(name);
    //     // $("#addPlace_popup_layer #place-address").text(address);
    //
    //     console.log(places.place_name);
    //     console.log(places.address_name);
    //
    //     $('input[id=place-name]').attr('value',places.place_name);
    //     $('input[id=place-address]').attr('value',places.address_name);
    //     $('input[id=place-lat]').attr('value',places.y);
    //     $('input[id=place-lon]').attr('value',places.x);
    //
    //     // $('#popup_box2').modal('show');
    //     console.log("íŒì—… ë²„íŠ¼ í´ë¦­!" + name + address);
    // }

    // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰
    searchPlaces();

    function searchPlaces(){
        // inputì— ë“¤ì–´ê°€ëŠ” í‚¤ì›Œë“œì˜ valueê°’ì´ keyword
        let keyword = document.getElementById('keyword').value;

        // keywordê°€ ê³µë°±ì´ë©´ alert ëœ¨ë„ë¡
//         if(!keyword.replace(/^\s+|\s+$/g,'')){
//             alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
//             return false;
//             // ì˜ ì‘ë™ì¤‘
//         }

        // if(!keyword.replace(/^\s+|\s+$/g,'')){
        //     alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        //     return false;
        //     // ì˜ ì‘ë™ì¤‘
        // }

        let sw = new kakao.maps.LatLng(37.41847533960485,126.75578831035362);
        let ne = new kakao.maps.LatLng(37.70625487247741,127.2251487382762);
        let bounds = new kakao.maps.LatLngBounds(sw,ne);

        ps.keywordSearch( keyword, placesSearchCB,{
            size:15,
            location: new kakao.maps.LatLng(37.550929, 126.990940),
            bounds: bounds,
        }); // keyword = í•´ìš´ëŒ€ë§›ì§‘ => keywordSearch("í•´ìš´ëŒ€ë§›ì§‘",placeSearchCB);
        console.log("ps.keywordSearch ì‘ë™ì¤‘")
    }

    // í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ ì™„ë£Œì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜
    function placesSearchCB(data, status, pagination){
        console.log("placeSearhCBë“¤ì–´ì˜´")
        if(status === kakao.maps.services.Status.OK){
            console.log("placeSearchCB status ì¼ì¹˜");
            // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ ì¬ì„¤ì •í•˜ê¸° ìœ„í•´
            // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•œë‹¤.

            displayPlaces(data);

            displayPagination(pagination);

            console.log("displayplaces í†µê³¼");
            // boundssì™€ data ê°œìˆ˜ì— ë”°ë¼ ë§ˆì»¤ í‘œì‹œí•˜ê³  boundì— ì¶”ê°€í•˜ëŠ” ì½”ë“œëŠ”
            // SearchListPlaces í•¨ìˆ˜ë¡œ ë„£ì–´ì„œ ê´€ë¦¬
            // let bounds = new kakao.maps.LatLngBounds();

            // for(let i=0; i<data.length;i++){
            //     displayMarker(data[i]);
            //     bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            // }

            //  ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì • -> setBounds
            // map.setBounds(bounds);
        }
    }

    function getListItem(index, places){
        var hasAuth = document.getElementById("isAuthorized").value;

        console.log("ì§ˆë¬¸");
        console.log("hasAuth:" +hasAuth);
        let el = document.createElement('li'),

            itemStr = '<span class="markerbg marker_' + (index+1) + '"></span>' +
                '<div class="info">' +
                '   <h5>' + places.place_name + '</h5>';

        if(places.address_name){
            itemStr += '    <span class="jibun gray">'+places.address_name+'</span>';
            console.log("ì£¼ì†ŒëŠ” : "+places.address_name);
        }

        // ì•„ì´í…œ ë‚´ button ì¶”ê°€
        // itemStr += '    <a class="btn btn-secondary btn-sm" onclick='+ hrefLink() +'>ì¥ì†Œ ë“±ë¡</a>'
        //itemStr += '    <a class="btn btn-secondary btn-sm" href=/map/addPlace/'+ encodeURIComponent(places.place_name) +'/'+encodeURIComponent(places.address_name)+'>ì¥ì†Œ ë“±ë¡</a>'
        if(hasAuth === 'Y') {
            itemStr += '    <button onclick="selectPopUpPlace(this,\''+ places.place_name + '\',\'' + places.address_name + '\');" data-id="'+ places.id +'" data-lat="'+places.y+'" data-lon="'+places.x+'" class="btn btn-primary" data-toggle="modal" href="#addPlace_popup_layer">ì¥ì†Œ ë“±ë¡ íŒì—…</button>'
        } else {
            itemStr += '    <button class="btn btn-primary disabled" >ë¡œê·¸ì¸ í›„ ë“±ë¡ê°€ëŠ¥</button>'
        }
        // itemStr += '    <button onclick="selectPopUpPlace1(this);" id="placeAddButton1" class="btn btn-primary" data-toggle="modal" href="#addPlace_popup_layer">ì¥ì†Œ ë“±ë¡ íŒì—…1</button>'
        itemStr += '</div>'

        el.innerHTML = itemStr;
        el.className = 'item';

        return el;
    }

    function addMarker(position, idx, title){
        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // ë§ˆì»¤ ì´ë¯¸ì§€ url, ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ë¥¼ ì”ë‹ˆë‹¤
            imageSize = new kakao.maps.Size(36, 37),  // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ í¬ê¸°
            imgOptions =  {
                spriteSize : new kakao.maps.Size(36, 691), // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ì˜ í¬ê¸°
                spriteOrigin : new kakao.maps.Point(0, (idx*46)+10), // ìŠ¤í”„ë¼ì´íŠ¸ ì´ë¯¸ì§€ ì¤‘ ì‚¬ìš©í•  ì˜ì—­ì˜ ì¢Œìƒë‹¨ ì¢Œí‘œ
                offset: new kakao.maps.Point(13, 37) // ë§ˆì»¤ ì¢Œí‘œì— ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ë‚´ì—ì„œì˜ ì¢Œí‘œ
            },
            markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
                position: position, // ë§ˆì»¤ì˜ ìœ„ì¹˜
                image: markerImage
            });
        console.log(marker);
        console.log("ê°€ê²Œì´ë¦„ì€"+title);
        displayInfowindow(marker,title);
        // ì§€ë„ ìœ„ì— ë§ˆì»¤ í‘œì¶œ
        marker.setMap(map);
        // ë°°ì—´ì— ìƒì„±ëœ ë§ˆì»¤ë¥¼ ì¶”ê°€í•œë‹¤.
        markers.push(marker);

        return marker;
    }


    // ì§€ë„ ìœ„ì— í‘œì‹œë˜ëŠ” ë§ˆì»¤ë¥¼ ëª¨ë‘ ì œê±°
    function removeMarker(){
        for (let i =0;i < markers.length; i++){
            markers[i].setMap(null);
        }
        markers=[];
    }

    // infowindowì— ì¥ì†Œëª…ì„ í‘œì‹œí•œë‹¤.
    function displayInfowindow(marker, title){
        let content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

        infowindow.setContent(content);
        infowindow.open(map, marker);
    }

    function removeAllchildNodes(el){
        while(el.hasChildNodes()){
            el.removeChild(el.lastChild);
        }
    }

    function displayPlaces(places){
        let listEl = document.getElementById('placeList'),
            menuEl = document.getElementById('search_wrap'),
            fragment = document.createDocumentFragment(),
            bounds = new kakao.maps.LatLngBounds();
        let listStr = '';

        // ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì— ì¶”ê°€ëœ í•­ëª©ë“¤ì„ ì œê±°í•œë‹¤.
        removeAllchildNodes(listEl);

        // ì§€ë„ì— í‘œì‹œë˜ê³  ìˆëŠ” ë§ˆì»¤ë¥¼ ì œê±°í•œë‹¤.
        removeMarker();

        for (let i=0;i<places.length;i++){
            console.log(places[i]);

        }

        for (let i=0;i<places.length;i++){
            console.log(places[i]);
            let placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
                marker = addMarker(placePosition,i,places[i].place_name),
                itemEl = getListItem(i, places[i]); // ê²€ìƒ‰ ê²°ê³¼ í•­ëª© Elementë¥¼ ìƒì„±í•©ë‹ˆë‹¤

            bounds.extend(placePosition);

            console.log("ì—¬ê¸°ê¹Œì§€ ì˜¤ë‚˜");
            console.log(marker);
            (function (){
                console.log("ìµëª…í•¨ìˆ˜ ì‹¤í–‰í•´ë³´ê¸°");
            })();

            (function(marker, title) {

                // kakao.maps.event.addListener(marker, 'mouseover', function() {
                //     displayInfowindow(marker, title);
                // });
                //
                // kakao.maps.event.addListener(marker, 'mouseout', function() {
                //     infowindow.close();
                // });


                itemEl.onmouseover =  function () {
                    displayInfowindow(marker, title);
                    console.log(title);
                };

                itemEl.onmouseout =  function () {
                    infowindow.close();
                };
            })(marker, places[i].place_name);

            fragment.appendChild(itemEl);
            console.log("ë°˜ë³µë¬¸ ë„ëŠ”ì§€ í™•ì¸");
        }

        console.log(fragment);
        listEl.appendChild(fragment);
        console.log(listEl);
        menuEl.scrollTop = 0;
        // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ ì„¤ì •
        map.setBounds(bounds);
    }
    function displayPagination(pagination) {
        var paginationEl = document.getElementById('pagination'),
            fragment = document.createDocumentFragment(),
            i;

        // ê¸°ì¡´ì— ì¶”ê°€ëœ í˜ì´ì§€ë²ˆí˜¸ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤
        while (paginationEl.hasChildNodes()) {
            paginationEl.removeChild (paginationEl.lastChild);
        }

        for (i=1; i<=pagination.last; i++) {
            var el = document.createElement('a');
            el.href = "#";
            el.innerHTML = i;

            if (i===pagination.current) {
                el.className = 'on';
            } else {
                el.onclick = (function(i) {
                    return function() {
                        pagination.gotoPage(i);
                    }
                })(i);
            }

            fragment.appendChild(el);
        }
        paginationEl.appendChild(fragment);
    }
</script>

<!--íŒì—…ì°½ ë ˆì´ì•„ì›ƒ html-->
<div id="popup_layer">
    <div id="popup_box">
        <!--íŒì—… ì»¨í…ì¸  ì˜ì—­-->
        <div id="popup_contents ">
            <th:block th:replace="popup/popup :: contentsTop"></th:block>
            <th:block th:replace="popup/popup :: contentsMiddle"></th:block>
            <th:block th:replace="popup/popup :: contentsBottom"></th:block>
        </div>
    </div>
</div>

<!--ì¥ì†Œ ë“±ë¡ íŒì—…ì°½ ë ˆì´ì•„ì›ƒ html-->
<div id="addPlace_popup_layer">
    <div id="popup_box2">
        <!--íŒì—… ì»¨í…ì¸  ì˜ì—­-->
        <div>
            <th:block th:replace="popup/addPlace"></th:block>
        </div>
    </div>
</div>

</body>
<script>

</script>
</html>
<!--git remote update  -> git checkout í•´ë‹¹ ë¸Œëœì¹˜ -> git merge  -->
<!-- -->
